within HVDCcomponents.TEST;

model TEST_2VSCs_DCcable_with_all_controls_bis
  OpenIPSL.Electrical.Buses.Bus bus1(S_b = 1000, V_b = 230, displayPF = true, fn = 50) annotation(
    Placement(visible = true, transformation(origin = {116, 2}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  OpenIPSL.Electrical.Buses.InfiniteBus infiniteBus1(S_b = 1000, V_b = 230, fn = 50) annotation(
    Placement(visible = true, transformation(origin = {108, -34}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  Modelica.Blocks.Sources.Constant const(k = 230E3) annotation(
    Placement(visible = true, transformation(origin = {54, 50}, extent = {{6, -6}, {-6, 6}}, rotation = 0)));
  Modelica.Blocks.Sources.Constant const1(k = 4350) annotation(
    Placement(visible = true, transformation(origin = {54, 30}, extent = {{6, -6}, {-6, 6}}, rotation = 0)));
  HVDCcomponents.PQ_sensor pQ_sensor1(S_b = 1000) annotation(
    Placement(visible = true, transformation(origin = {84.4, 2}, extent = {{-6, -5}, {6, 5}}, rotation = 0)));
  Modelica.Electrical.Analog.Basic.Ground ground1 annotation(
    Placement(visible = true, transformation(origin = {-55, -27}, extent = {{-7, -7}, {7, 7}}, rotation = 0)));
  Modelica.Electrical.Analog.Basic.Capacitor capacitor2(C = 195E-6, v(start = 640E3)) annotation(
    Placement(visible = true, transformation(origin = {-111, -5}, extent = {{-7, -7}, {7, 7}}, rotation = -90)));
  HVDCcomponents.VSC_station_dq0_with_control vSC_station_dq0_with_control2(Lr = 100E-3, Rr = 0.0125, tr = 10E-3, wg = 314) annotation(
    Placement(visible = true, transformation(origin = {-166, 0}, extent = {{40, -13}, {-20, 12}}, rotation = 0)));
  HVDCcomponents.PQ_sensor pQ_sensor2(S_b = 1000) annotation(
    Placement(visible = true, transformation(origin = {-231.6, 0}, extent = {{6, -5}, {-6, 5}}, rotation = 0)));
  OpenIPSL.Electrical.Buses.Bus bus2(S_b = 1000, V_b = 230, displayPF = true, fn = 50) annotation(
    Placement(visible = true, transformation(origin = {-264, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  OpenIPSL.Electrical.Buses.InfiniteBus infiniteBus2(S_b = 1000, V_b = 230, fn = 50) annotation(
    Placement(visible = true, transformation(origin = {-272, -36}, extent = {{10, -10}, {-10, 10}}, rotation = 0)));
  Modelica.Blocks.Sources.Constant const3(k = 4350) annotation(
    Placement(visible = true, transformation(origin = {-204, 34}, extent = {{-6, -6}, {6, 6}}, rotation = 0)));
  Modelica.Blocks.Sources.Constant const4(k = 230E3) annotation(
    Placement(visible = true, transformation(origin = {-204, 58}, extent = {{-6, -6}, {6, 6}}, rotation = 0)));
  HVDCcomponents.VSC_station_dq0_with_control vSC_station_dq0_with_control1(Lr = 100E-3, Rr = 0.0125, tr = 3E-3, wg = 314) annotation(
    Placement(visible = true, transformation(origin = {8, 2}, extent = {{-20, -13}, {40, 12}}, rotation = 0)));
  Modelica.Electrical.Analog.Basic.Capacitor capacitor1(C = 195E-6, v(start = 640E3)) annotation(
    Placement(visible = true, transformation(origin = {-55, -5}, extent = {{-7, -7}, {7, 7}}, rotation = -90)));
  HVDCcomponents.DC_cable dC_cable1(Vinit = 640E3, length = 200) annotation(
    Placement(visible = true, transformation(origin = {-81, -5}, extent = {{-7, -7}, {7, 7}}, rotation = 0)));
  Modelica.Blocks.Sources.Step step1(height = 500E6, startTime = 3)  annotation(
    Placement(visible = true, transformation(origin = {-134, 66}, extent = {{-8, -8}, {8, 8}}, rotation = 0)));
  Modelica.Blocks.Sources.Step step2(height = -500E6, startTime = 3) annotation(
    Placement(visible = true, transformation(origin = {-44, 68}, extent = {{-8, -8}, {8, 8}}, rotation = 0)));
  Modelica.Blocks.Sources.Step step3(height = 0, startTime = 3) annotation(
    Placement(visible = true, transformation(origin = {-92, 76}, extent = {{-8, -8}, {8, 8}}, rotation = 0)));
equation
  connect(vSC_station_dq0_with_control1.Qref, step3.y) annotation(
    Line(points = {{-4, 6}, {-68, 6}, {-68, 76}, {-84, 76}, {-84, 76}}, color = {0, 0, 127}));
  connect(step3.y, vSC_station_dq0_with_control2.Qref) annotation(
    Line(points = {{-84, 76}, {-78, 76}, {-78, 10}, {-136, 10}, {-136, 4}, {-154, 4}, {-154, 4}}, color = {0, 0, 127}));
  connect(step2.y, vSC_station_dq0_with_control1.Pref) annotation(
    Line(points = {{-36, 68}, {-14, 68}, {-14, 10}, {-4, 10}, {-4, 10}}, color = {0, 0, 127}));
  connect(step1.y, vSC_station_dq0_with_control2.Pref) annotation(
    Line(points = {{-126, 66}, {-122, 66}, {-122, 20}, {-146, 20}, {-146, 8}, {-154, 8}, {-154, 8}}, color = {0, 0, 127}));
  connect(capacitor1.p, dC_cable1.pin_p1) annotation(
    Line(points = {{-54, 2}, {-66, 2}, {-66, -2}, {-74, -2}, {-74, -2}}, color = {0, 0, 255}));
  connect(capacitor1.n, dC_cable1.pin_n1) annotation(
    Line(points = {{-54, -12}, {-66, -12}, {-66, -8}, {-74, -8}, {-74, -8}}, color = {0, 0, 255}));
  connect(dC_cable1.pin_n, capacitor2.n) annotation(
    Line(points = {{-88, -8}, {-94, -8}, {-94, -12}, {-110, -12}, {-110, -12}}, color = {0, 0, 255}));
  connect(capacitor2.p, dC_cable1.pin_p) annotation(
    Line(points = {{-110, 2}, {-94, 2}, {-94, -2}, {-88, -2}, {-88, -2}}, color = {0, 0, 255}));
  connect(ground1.p, capacitor1.n) annotation(
    Line(points = {{-54, -20}, {-54, -20}, {-54, -12}, {-54, -12}}, color = {0, 0, 255}));
  connect(vSC_station_dq0_with_control1.pin_p, capacitor1.p) annotation(
    Line(points = {{-4, 0}, {-50, 0}, {-50, 2}, {-54, 2}, {-54, 2}}, color = {0, 0, 255}));
  connect(capacitor1.n, vSC_station_dq0_with_control1.pin_n) annotation(
    Line(points = {{-54, -12}, {-12, -12}, {-12, -4}, {-2, -4}, {-2, -4}}, color = {0, 0, 255}));
  connect(pQ_sensor1.p, vSC_station_dq0_with_control1.p) annotation(
    Line(points = {{78, 2}, {19, 2}}, color = {0, 0, 255}));
  connect(vSC_station_dq0_with_control1.Ib, const1.y) annotation(
    Line(points = {{14, 14}, {14, 30}, {47, 30}}, color = {0, 0, 127}));
  connect(vSC_station_dq0_with_control1.Vb, const.y) annotation(
    Line(points = {{9, 14}, {9, 50}, {47, 50}}, color = {0, 0, 127}));
  connect(pQ_sensor1.n, bus1.p) annotation(
    Line(points = {{90, 2}, {116.4, 2}}, color = {0, 0, 255}));
  connect(bus1.p, infiniteBus1.p) annotation(
    Line(points = {{116, 2}, {132, 2}, {132, -34}, {125, -34}, {125, -34}, {123.5, -34}, {123.5, -34}, {118, -34}}, color = {0, 0, 255}));
  connect(const4.y, vSC_station_dq0_with_control2.Vb) annotation(
    Line(points = {{-198, 58}, {-166, 58}, {-166, 12}, {-168, 12}}, color = {0, 0, 127}));
  connect(const3.y, vSC_station_dq0_with_control2.Ib) annotation(
    Line(points = {{-198, 34}, {-172, 34}, {-172, 12}, {-172, 12}}, color = {0, 0, 127}));
  connect(pQ_sensor2.p, vSC_station_dq0_with_control2.p) annotation(
    Line(points = {{-226, 0}, {-177, 0}}, color = {0, 0, 255}));
  connect(vSC_station_dq0_with_control2.pin_n, capacitor2.n) annotation(
    Line(points = {{-155, -6}, {-126, -6}, {-126, -12}, {-110, -12}}, color = {0, 0, 255}));
  connect(vSC_station_dq0_with_control2.pin_p, capacitor2.p) annotation(
    Line(points = {{-155, -2}, {-130, -2}, {-130, 2}, {-110, 2}}, color = {0, 0, 255}));
  connect(bus2.p, infiniteBus2.p) annotation(
    Line(points = {{-264, 0}, {-290, 0}, {-290, -36}, {-282, -36}, {-282, -36}}, color = {0, 0, 255}));
  connect(pQ_sensor2.n, bus2.p) annotation(
    Line(points = {{-238, 0}, {-264, 0}, {-264, 0}, {-264, 0}}, color = {0, 0, 255}));
  annotation(
    Diagram(graphics = {Line(origin = {0, 8}, points = {{0, 0}})}, coordinateSystem(extent = {{-300, -100}, {150, 100}})),
    Icon(coordinateSystem(extent = {{-300, -100}, {150, 100}})),
    __OpenModelica_commandLineOptions = "");


end TEST_2VSCs_DCcable_with_all_controls_bis;
